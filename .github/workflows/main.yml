name: Hybrid Deploy Strategy

on:
  push:
    branches: [ main ]

jobs:
  # 1. 먼저 내 서버(Self-hosted)에서 시도
  try-self-hosted:
    uses: ./.github/workflows/deploy.yml # 위의 파일 호출
    with:
      runner-label: 'self-hosted' # 내 서버 라벨 전달
    secrets: inherit # 비밀키 다 넘겨줌

  # 2. 실패 시 GitHub 서버(Ubuntu)에서 시도
  fallback-github:
    needs: try-self-hosted
    if: failure() # 앞의 Job이 실패(타임아웃 포함)했을 때만 실행
    uses: ./.github/workflows/deploy.yml # 똑같은 파일 재활용!
    with:
      runner-label: 'ubuntu-latest' # 깃허브 서버 라벨 전달
    secrets: inherit